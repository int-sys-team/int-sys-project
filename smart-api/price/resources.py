from flask import request
from flask_restful import Resource
from price.code import predict_price

class PriceRegressor(Resource):
    # TODO Scheme should be autogenerated somehow?
    def post(self):
        """
        Predicts the price of the real estate property based on its data.

        ---
        parameters:
          - name: body
            in: body
            required: true
            description: Data about the real estate object.
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  type: object
                  description: The data about the property.
                  properties:
                    zipcode:
                      type: integer
                    latitude:
                      type: number
                    longitude:
                      type: number
                    garageSpaces:
                      type: integer
                    hasAssociation:
                      type: integer
                    hasCooling:
                      type: integer
                    hasGarage:
                      type: integer
                    hasHeating:
                      type: integer
                    hasSpa:
                      type: integer
                    hasView:
                      type: integer
                    homeType:
                      type: string
                    parkingSpaces:
                      type: integer
                    yearBuilt:
                      type: integer
                    numOfPhotos:
                      type: integer
                    accessibility:
                      type: integer
                    numOfAppliances:
                      type: integer
                    numOfParkingFeatures:
                      type: integer
                    patioporch:
                      type: integer
                    security:
                      type: integer
                    waterfront:
                      type: integer
                    windowfeatures:
                      type: integer
                    community:
                      type: integer
                    lotSizeSqFt:
                      type: number
                    livingAreaSqFt:
                      type: number
                    numOfPrimarySchools:
                      type: integer
                    numOfElementarySchools:
                      type: integer
                    numOfMiddleSchools:
                      type: integer
                    numOfHighSchools:
                      type: integer
                    avgSchoolDistance:
                      type: number
                    avgSchoolRating:
                      type: number
                    avgSchoolSize:
                      type: integer
                    MedianStudentsPerTeacher:
                      type: integer
                    numOfBathrooms:
                      type: number
                    numOfBedrooms:
                      type: integer
                    numOfStories:
                      type: integer
        responses:
          200:
            description: The predicted price.
            content:
              application/json:
                schema:
                  type: object
                  properties:
                    price:
                      type: float
                      description: The predicted price.
        """
        data: dict = request.get_json()
        if not data:
            return {"error": "Request body cannot be empty."}, 400
        if "data" not in data:
            return {"error": "Request body must contain data"}, 400
        try:
            response = predict_price(data.get("data"))
            return {"price": response}, 200
        except Exception as e:
            return {
                "error": "Price regressor failed.",
                "description": "This is a default description.",
                "details": str(e)
            }, 500


